import { getCachedConfig } from "../../services/configService.js";

export const qr = async (sock, m, args) => {
    const config = getCachedConfig();
    const p = config.prefix || "!";

    const text = args.join(" ");
    if (!text) {
        return `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     ğŸ“± *â„šâ„ â„‚ğ•†ğ”»ğ”¼ ğ•„ğ”¸ğ•‚ğ”¼â„* ğŸ“±       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ *ğ•Œğ•¤ğ•’ğ•˜ğ•–:* ${p}qr [text/link]
ğŸ“Œ *ğ”¼ğ•©ğ•’ğ•ğ•¡ğ•ğ•–:* ${p}qr https://example.com

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Generate QR codes for any text or URL!`;
    }

    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=${encodeURIComponent(text)}`;

    try {
        const displayText = text.length > 50 ? text.substring(0, 50) + "..." : text;

        return {
            image: { url: qrUrl },
            caption: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ“± *â„šâ„ â„‚ğ•†ğ”»ğ”¼ ğ”¾ğ”¼â„•ğ”¼â„ğ”¸ğ•‹ğ”¼ğ”»* ğŸ“±     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“„ *ğ”»ğ”¸ğ•‹ğ”¸ ğ”¼â„•â„‚ğ•†ğ”»ğ”¼ğ”»*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${displayText}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
_Scan with any QR reader app!_ ğŸ“·`
        };
    } catch (err) {
        return `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         âŒ *ğ”¼â„â„ğ•†â„* âŒ            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Failed to generate QR code.
Please try again later.`;
    }
};
